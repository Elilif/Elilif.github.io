<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-03-24 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>浅析 org babel switches</title>
<meta name="author" content="Eli Qian" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/static/favion.png">
<link rel="stylesheet" type="text/css" href="/css/styles.css"/>
<link rel="stylesheet" type="text/css" href="/css/htmlize.css" />
                  <script src="/scripts/script.js"></script>
                  <script src="/scripts/toc.js"></script>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<style>
.content:has([value="all"]:checked) li{display: list-item;}

.content:has([value="CSS"]:checked)
 li:has([data-tags~="#CSS"]){display: list-item;}
.content:has([value="blog"]:checked)
 li:has([data-tags~="#blog"]){display: list-item;}
.content:has([value="emacs"]:checked)
 li:has([data-tags~="#emacs"]){display: list-item;}
.content:has([value="org"]:checked)
 li:has([data-tags~="#org"]){display: list-item;}
</style>
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<nav class="nav">
  <a href="/index.html" class="button">Home</a>
  <a href="/config.html" class="button">Literate Emacs Config</a>
  <a href="/rss.xml" class="button">RSS</a>
</nav>
<hr>
</div>
<div id="content" class="content">
<header>
<h1 class="title">浅析 org babel switches</h1>
</header><div class="post-status"><span><i class='bx bx-calendar'></i>
<span>2024-03-01</span></span>
<span><i class='bx bx-edit'></i><span>2024-03-09</span></span><span><i class='bx bx-history'></i><span><a href="https://github.com/Elilif/Elilif.github.io/commits/master/orgs/2024-03-01-org-babel-switches.org">History</a></span></span><span><i class='bx bxs-hourglass'></i>1183 字</span></div><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#什么是-=switches=-?">什么是 <code>switches</code> ?</a></li>
<li><a href="#使用分享">使用分享</a></li>
<li><a href="#总结">总结</a></li>
</ul>
</div>
</nav>
<div class="abstract">
<p>
本文以分析函数 <code>org-element-src-block-parser</code> 为例，简要介绍了 Org-mode 代码块中
<code>switches</code> 的作用和用法。
</p>

</div>
<div id="outline-container-什么是-=switches=-?" class="outline-2">
<h2 id="什么是-=switches=-?">什么是 <code>switches</code> ?</h2>
<div class="outline-text-2" id="text-什么是-=switches=-?">
<p>
<code>switches</code> 是 <code>#+BEGIN_SRC</code> <sup><label for="fnr.1" class="footref">1</label></sup><input id="fnr.1" class="footref-toggle" type="checkbox"> 一栏上的可选参数，其具体的位置如下：
</p>
<pre class="example">
#+BEGIN_SRC &lt;language&gt; &lt;switches&gt; &lt;header arguments&gt;
  &lt;body&gt;
#+END_SRC
</pre>
<p>
它的作用是提供更精细的代码导出控制<sup><label for="fnr.2" class="footref">2</label></sup><input id="fnr.2" class="footref-toggle" type="checkbox"> 。Org Manual 在 <a href="https://orgmode.org/manual/Literal-Examples.html">Literal Examples</a> 一节介绍几个 <code>switch</code> 及其用法，这里做个简单的总结：
</p>
<dl class="org-dl">
<dt>-n</dt><dd>在导出时给代码块添加行号。默认第一行的行号是 1 ，如果提供一个数字 a（如
<code>-n 10</code>），则第一行的行号是 a 。</dd>
<dt>+n</dt><dd>在导出时给代码块添加行号。但与 <code>-n</code> 不同的是，它是从上一个有行号的代码块的结束行开始计数，比如说上一个代码块的结束行号是 10 ，那么当前代码块就从 11 开始计数。<code>+n</code> 同样也接受一个可选的数字参数，作用与 <code>-n</code> 类似。</dd>
<dt>-l</dt><dd>为当前代码块设置 <code>org-coderef-label-format</code> 。</dd>
<dt>-r</dt><dd>导出时移除代码块中的引用标签（coderef label）。如果和 <code>-n</code> 一起用，则会把引用标签移到行号上（在 HTML 中就是设置行号所在元素的 <code>id</code> 属性）。</dd>
<dt>-i</dt><dd>导出时不修改代码块中的缩进。</dd>
<dt>-k</dt><dd>导出时保留代码块中的引用标签（coderef label）。</dd>
</dl>
</div>
</div>
<div id="outline-container-使用分享" class="outline-2">
<h2 id="使用分享">使用分享</h2>
<div class="outline-text-2" id="text-使用分享">
<p>
只是从纸面上讨论 <code>switches</code> 是非常枯燥的，同时也不容易让人明白其具体作用。所以接下来让我们实际体验一下 <code>switches</code> 的使用。我们以 <code>org-element-src-block-parser</code> 为例，分析一下 <code>switches</code> 是如何被解析的：
</p>

<p>
<code>org-element-src-block-parser</code> 主要由<a href="#regexp-match">regexp-match</a> ，<a href="#switches-analysis">switches-analysis</a> 和
<a href="#restult-construct">restult-construct</a>三个部分构成<sup><label for="fnr.3" class="footref">3</label></sup><input id="fnr.3" class="footref-toggle" type="checkbox"> :
</p>
<div class="multilang">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>org-element-src-block-parser</label><pre class="src src-emacs-lisp" id="org-element-src-block-parser"><span class="linenr"> 1: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">defun</span><span class="org-whitespace-space"> </span><span class="org-function-name">org-element-src-block-parser</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>limit<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="linenr"> 2: </span><span class="org-whitespace-space">  </span><span class="org-doc">"Parse</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">source</span><span class="org-whitespace-space"> </span><span class="org-doc">block.</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span class="org-doc">LIMIT</span><span class="org-whitespace-space"> </span><span class="org-doc">bounds</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">search.</span><span class="org-whitespace-space">  </span><span class="org-doc">AFFILIATED</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">list</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">which</span><span class="org-whitespace-space"> </span><span class="org-doc">CAR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span>
<span class="linenr"> 5: </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">buffer</span><span class="org-whitespace-space"> </span><span class="org-doc">position</span><span class="org-whitespace-space"> </span><span class="org-doc">at</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">beginning</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">first</span><span class="org-whitespace-space"> </span><span class="org-doc">affiliated</span>
<span class="linenr"> 6: </span><span class="org-doc">keyword</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span><span class="org-whitespace-space"> </span><span class="org-doc">CDR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">plist</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">affiliated</span><span class="org-whitespace-space"> </span><span class="org-doc">keywords</span><span class="org-whitespace-space"> </span><span class="org-doc">along</span><span class="org-whitespace-space"> </span><span class="org-doc">with</span>
<span class="linenr"> 7: </span><span class="org-doc">their</span><span class="org-whitespace-space"> </span><span class="org-doc">value.</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span class="org-doc">Return</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">list</span><span class="org-whitespace-space"> </span><span class="org-doc">whose</span><span class="org-whitespace-space"> </span><span class="org-doc">CAR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">src-block</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span><span class="org-whitespace-space"> </span><span class="org-doc">CDR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">plist</span>
<span class="linenr">10: </span><span class="org-doc">containing</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:language</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:switches</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:parameters</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:begin</span></span><span class="org-doc">',</span>
<span class="linenr">11: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:end</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:number-lines</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:retain-labels</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:use-labels</span></span><span class="org-doc">',</span>
<span class="linenr">12: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:label-fmt</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:preserve-indent</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:value</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:post-blank</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span>
<span class="linenr">13: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:post-affiliated</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">keywords.</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span class="org-doc">Assume</span><span class="org-whitespace-space"> </span><span class="org-doc">point</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">at</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">beginning</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">block."</span>
<span class="linenr">16: </span><span class="org-whitespace-space">  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">let</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>case-fold-search<span class="org-whitespace-space"> </span>t<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">17: </span><span class="org-whitespace-space">    </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-keyword">save-excursion</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>re-search-forward<span class="org-whitespace-space"> </span><span class="org-string">"^[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*#\\+END_SRC[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*$"</span>
<span class="linenr">18: </span><span class="org-whitespace-space">                                                </span>limit<span class="org-whitespace-space"> </span>t<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">19: </span><span class="org-whitespace-space">        </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Incomplete</span><span class="org-whitespace-space"> </span><span class="org-comment">block:</span><span class="org-whitespace-space"> </span><span class="org-comment">parse</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">paragraph.</span>
<span class="linenr">20: </span><span class="org-whitespace-space">        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>org-element-paragraph-parser<span class="org-whitespace-space"> </span>limit<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">21: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">let</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>contents-end<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>match-beginning<span class="org-whitespace-space"> </span>0<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span>
<span class="linenr">22: </span><span class="org-whitespace-space">        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-keyword">save-excursion</span>
<span class="linenr">23: </span><span class="org-whitespace-space">          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-keyword">let*</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>
<span class="linenr">24: </span><span class="org-whitespace-space">                 </span>&lt;&lt;<a href="#regexp-match">regexp-match</a>&gt;&gt;
<span class="linenr">25: </span><span class="org-whitespace-space">                 </span>&lt;&lt;<a href="#switches-analysis">switches-analysis</a>&gt;&gt;
<span class="linenr">26: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Retrieve</span><span class="org-whitespace-space"> </span><span class="org-comment">code.</span>
<span class="linenr">27: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>value<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>org-unescape-code-in-string
<span class="linenr">28: </span><span class="org-whitespace-space">                         </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>buffer-substring-no-properties
<span class="linenr">29: </span><span class="org-whitespace-space">                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>line-beginning-position<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span>contents-end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">30: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>pos-before-blank<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">progn</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>goto-char<span class="org-whitespace-space"> </span>contents-end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">31: </span><span class="org-whitespace-space">                                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>forward-line<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">32: </span><span class="org-whitespace-space">                                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">33: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">position</span><span class="org-whitespace-space"> </span><span class="org-comment">after</span><span class="org-whitespace-space"> </span><span class="org-comment">ending</span><span class="org-whitespace-space"> </span><span class="org-comment">blank</span><span class="org-whitespace-space"> </span><span class="org-comment">lines.</span>
<span class="linenr">34: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>end<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">progn</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>skip-chars-forward<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">\r\t\n"</span><span class="org-whitespace-space"> </span>limit<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">35: </span><span class="org-whitespace-space">                             </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>eobp<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>line-beginning-position<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span>
<span class="linenr">36: </span><span class="org-whitespace-space">            </span>&lt;&lt;<a href="#restult-construct">restult-construct</a>&gt;&gt;<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="linenr"> 1: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">defun</span><span class="org-whitespace-space"> </span><span class="org-function-name">org-element-src-block-parser</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>limit<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="linenr"> 2: </span><span class="org-whitespace-space">  </span><span class="org-doc">"Parse</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">source</span><span class="org-whitespace-space"> </span><span class="org-doc">block.</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span class="org-doc">LIMIT</span><span class="org-whitespace-space"> </span><span class="org-doc">bounds</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">search.</span><span class="org-whitespace-space">  </span><span class="org-doc">AFFILIATED</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">list</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">which</span><span class="org-whitespace-space"> </span><span class="org-doc">CAR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span>
<span class="linenr"> 5: </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">buffer</span><span class="org-whitespace-space"> </span><span class="org-doc">position</span><span class="org-whitespace-space"> </span><span class="org-doc">at</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">beginning</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">first</span><span class="org-whitespace-space"> </span><span class="org-doc">affiliated</span>
<span class="linenr"> 6: </span><span class="org-doc">keyword</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span><span class="org-whitespace-space"> </span><span class="org-doc">CDR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">plist</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">affiliated</span><span class="org-whitespace-space"> </span><span class="org-doc">keywords</span><span class="org-whitespace-space"> </span><span class="org-doc">along</span><span class="org-whitespace-space"> </span><span class="org-doc">with</span>
<span class="linenr"> 7: </span><span class="org-doc">their</span><span class="org-whitespace-space"> </span><span class="org-doc">value.</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span class="org-doc">Return</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">list</span><span class="org-whitespace-space"> </span><span class="org-doc">whose</span><span class="org-whitespace-space"> </span><span class="org-doc">CAR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">src-block</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span><span class="org-whitespace-space"> </span><span class="org-doc">CDR</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">a</span><span class="org-whitespace-space"> </span><span class="org-doc">plist</span>
<span class="linenr">10: </span><span class="org-doc">containing</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:language</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:switches</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:parameters</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:begin</span></span><span class="org-doc">',</span>
<span class="linenr">11: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:end</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:number-lines</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:retain-labels</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:use-labels</span></span><span class="org-doc">',</span>
<span class="linenr">12: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:label-fmt</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:preserve-indent</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:value</span></span><span class="org-doc">',</span><span class="org-whitespace-space"> </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:post-blank</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">and</span>
<span class="linenr">13: </span><span class="org-doc">`</span><span class="org-doc"><span class="org-constant">:post-affiliated</span></span><span class="org-doc">'</span><span class="org-whitespace-space"> </span><span class="org-doc">keywords.</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span class="org-doc">Assume</span><span class="org-whitespace-space"> </span><span class="org-doc">point</span><span class="org-whitespace-space"> </span><span class="org-doc">is</span><span class="org-whitespace-space"> </span><span class="org-doc">at</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">beginning</span><span class="org-whitespace-space"> </span><span class="org-doc">of</span><span class="org-whitespace-space"> </span><span class="org-doc">the</span><span class="org-whitespace-space"> </span><span class="org-doc">block."</span>
<span class="linenr">16: </span><span class="org-whitespace-space">  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">let</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>case-fold-search<span class="org-whitespace-space"> </span>t<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">17: </span><span class="org-whitespace-space">    </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-keyword">save-excursion</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>re-search-forward<span class="org-whitespace-space"> </span><span class="org-string">"^[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*#\\+END_SRC[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*$"</span>
<span class="linenr">18: </span><span class="org-whitespace-space">                                                </span>limit<span class="org-whitespace-space"> </span>t<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">19: </span><span class="org-whitespace-space">        </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Incomplete</span><span class="org-whitespace-space"> </span><span class="org-comment">block:</span><span class="org-whitespace-space"> </span><span class="org-comment">parse</span><span class="org-whitespace-space"> </span><span class="org-comment">it</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">paragraph.</span>
<span class="linenr">20: </span><span class="org-whitespace-space">        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>org-element-paragraph-parser<span class="org-whitespace-space"> </span>limit<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">21: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">let</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>contents-end<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>match-beginning<span class="org-whitespace-space"> </span>0<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span>
<span class="linenr">22: </span><span class="org-whitespace-space">        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span><span class="org-keyword">save-excursion</span>
<span class="linenr">23: </span><span class="org-whitespace-space">          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span><span class="org-keyword">let*</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>
<span class="linenr">24: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>begin<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>car<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">25: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>post-affiliated<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">26: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">language</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">string.</span>
<span class="linenr">27: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>language
<span class="linenr">28: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">progn</span>
<span class="linenr">29: </span><span class="org-whitespace-space">                    </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>looking-at
<span class="linenr">30: </span><span class="org-whitespace-space">                     </span><span class="org-string">"^[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*#\\+BEGIN_SRC\</span>
<span class="linenr">31: </span><span class="org-whitespace-space">                   </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\S-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\</span>
<span class="linenr">32: </span><span class="org-whitespace-space">                   </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">l</span><span class="org-whitespace-space"> </span><span class="org-string">\".+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[ikr]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[-+]n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">*[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\</span>
<span class="linenr">33: </span><span class="org-whitespace-space">                   </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*$"</span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">34: </span><span class="org-whitespace-space">                    </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>1<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">35: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">switches.</span>
<span class="linenr">36: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>switches<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space">                 </span><span class="org-comment">(ref:get-switches)</span>
<span class="linenr">37: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">parameters.</span>
<span class="linenr">38: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>parameters<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>3<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">39: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Switches</span><span class="org-whitespace-space"> </span><span class="org-comment">analysis.</span>
<span class="linenr">40: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>number-lines
<span class="linenr">41: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">42: </span><span class="org-whitespace-space">                       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\\&gt;"</span>
<span class="linenr">43: </span><span class="org-whitespace-space">                                     </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">44: </span><span class="org-whitespace-space">                       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>cons
<span class="linenr">45: </span><span class="org-whitespace-space">                        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>equal<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>match-string<span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-whitespace-space"> </span><span class="org-string">"-"</span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">46: </span><span class="org-whitespace-space">                            </span>'new
<span class="linenr">47: </span><span class="org-whitespace-space">                          </span>'continued<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="linenr">48: </span><span class="org-whitespace-space">                        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>match-end<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-whitespace-space"> </span>0
<span class="linenr">49: </span><span class="org-whitespace-space">                          </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Subtract</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">give</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">lines</span><span class="org-whitespace-space"> </span><span class="org-comment">before</span>
<span class="linenr">50: </span><span class="org-whitespace-space">                          </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">first</span><span class="org-whitespace-space"> </span><span class="org-comment">line.</span>
<span class="linenr">51: </span><span class="org-whitespace-space">                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>1-<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>string-to-number<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>match-string<span class="org-whitespace-space"> </span>2<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">52: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>preserve-indent
<span class="linenr">53: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">54: </span><span class="org-whitespace-space">                       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-i\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">55: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>label-fmt
<span class="linenr">56: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">57: </span><span class="org-whitespace-space">                       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-l</span><span class="org-whitespace-space"> </span><span class="org-string">+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\"\n]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\""</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">58: </span><span class="org-whitespace-space">                       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>match-string<span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">59: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Should</span><span class="org-whitespace-space"> </span><span class="org-comment">labels</span><span class="org-whitespace-space"> </span><span class="org-comment">be</span><span class="org-whitespace-space"> </span><span class="org-comment">retained</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">(or</span><span class="org-whitespace-space"> </span><span class="org-comment">stripped</span><span class="org-whitespace-space"> </span><span class="org-comment">from)</span>
<span class="linenr">60: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">source</span><span class="org-whitespace-space"> </span><span class="org-comment">blocks?</span>
<span class="linenr">61: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>retain-labels
<span class="linenr">62: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">or</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>not<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">63: </span><span class="org-whitespace-space">                      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-r\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">64: </span><span class="org-whitespace-space">                      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>number-lines<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-k\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">65: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">What</span><span class="org-whitespace-space"> </span><span class="org-comment">should</span><span class="org-whitespace-space"> </span><span class="org-comment">code-references</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">-</span><span class="org-whitespace-space"> </span><span class="org-comment">labels</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span>
<span class="linenr">66: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">line-numbers?</span>
<span class="linenr">67: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>use-labels
<span class="linenr">68: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">or</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>not<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">69: </span><span class="org-whitespace-space">                      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>retain-labels
<span class="linenr">70: </span><span class="org-whitespace-space">                           </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-k\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">71: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Retrieve</span><span class="org-whitespace-space"> </span><span class="org-comment">code.</span>
<span class="linenr">72: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>value<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>org-unescape-code-in-string
<span class="linenr">73: </span><span class="org-whitespace-space">                         </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>buffer-substring-no-properties
<span class="linenr">74: </span><span class="org-whitespace-space">                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>line-beginning-position<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span>contents-end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">75: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>pos-before-blank<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">progn</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>goto-char<span class="org-whitespace-space"> </span>contents-end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">76: </span><span class="org-whitespace-space">                                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>forward-line<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">77: </span><span class="org-whitespace-space">                                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span>
<span class="linenr">78: </span><span class="org-whitespace-space">                 </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">position</span><span class="org-whitespace-space"> </span><span class="org-comment">after</span><span class="org-whitespace-space"> </span><span class="org-comment">ending</span><span class="org-whitespace-space"> </span><span class="org-comment">blank</span><span class="org-whitespace-space"> </span><span class="org-comment">lines.</span>
<span class="linenr">79: </span><span class="org-whitespace-space">                 </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>end<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span><span class="org-keyword">progn</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>skip-chars-forward<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-whitespace-space"> </span><span class="org-string">\r\t\n"</span><span class="org-whitespace-space"> </span>limit<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">80: </span><span class="org-whitespace-space">                             </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>eobp<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>line-beginning-position<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span>
<span class="linenr">81: </span><span class="org-whitespace-space">            </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>list<span class="org-whitespace-space"> </span>'src-block
<span class="linenr">82: </span><span class="org-whitespace-space">                  </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">(</span></span>nconc
<span class="linenr">83: </span><span class="org-whitespace-space">                   </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>list<span class="org-whitespace-space"> </span><span class="org-builtin">:language</span><span class="org-whitespace-space"> </span>language
<span class="linenr">84: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:switches</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>org-string-nw-p<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="linenr">85: </span><span class="org-whitespace-space">                                        </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>org-trim<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">86: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:parameters</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>org-string-nw-p<span class="org-whitespace-space"> </span>parameters<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span>
<span class="linenr">87: </span><span class="org-whitespace-space">                                          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>org-trim<span class="org-whitespace-space"> </span>parameters<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">88: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:begin</span><span class="org-whitespace-space"> </span>begin
<span class="linenr">89: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:end</span><span class="org-whitespace-space"> </span>end
<span class="linenr">90: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:number-lines</span><span class="org-whitespace-space"> </span>number-lines
<span class="linenr">91: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:preserve-indent</span><span class="org-whitespace-space"> </span>preserve-indent
<span class="linenr">92: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:retain-labels</span><span class="org-whitespace-space"> </span>retain-labels
<span class="linenr">93: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:use-labels</span><span class="org-whitespace-space"> </span>use-labels
<span class="linenr">94: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:label-fmt</span><span class="org-whitespace-space"> </span>label-fmt
<span class="linenr">95: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:value</span><span class="org-whitespace-space"> </span>value
<span class="linenr">96: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:post-blank</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>count-lines<span class="org-whitespace-space"> </span>pos-before-blank<span class="org-whitespace-space"> </span>end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">97: </span><span class="org-whitespace-space">                         </span><span class="org-builtin">:post-affiliated</span><span class="org-whitespace-space"> </span>post-affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span>
<span class="linenr">98: </span><span class="org-whitespace-space">                   </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">(</span></span>cdr<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-9">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-8">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>

</div>


<p>
这几个部分的实现比较简单，因此我们将重点放在 <code>switches</code> 的导出效果上面。我们来逐个分析：
</p>
<div class="multilang">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>regexp-match</label><pre class="src src-emacs-lisp" id="regexp-match"><span class="linenr">24: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>begin<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>car<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">25: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>post-affiliated<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>point<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">26: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">language</span><span class="org-whitespace-space"> </span><span class="org-comment">as</span><span class="org-whitespace-space"> </span><span class="org-comment">a</span><span class="org-whitespace-space"> </span><span class="org-comment">string.</span>
<span class="linenr">27: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>language
<span class="linenr">28: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">progn</span>
<span class="linenr">29: </span><span class="org-whitespace-space">   </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>looking-at
<span class="linenr">30: </span><span class="org-whitespace-space">    </span><span class="org-string">"^[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*#\\+BEGIN_SRC\</span>
<span class="linenr">31: </span><span class="org-whitespace-space">  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\S-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\</span>
<span class="linenr">32: </span><span class="org-whitespace-space">  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">l</span><span class="org-whitespace-space"> </span><span class="org-string">\".+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[ikr]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[-+]n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">*[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\</span>
<span class="linenr">33: </span><span class="org-whitespace-space">  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[</span><span class="org-whitespace-space"> </span><span class="org-string">\t]*$"</span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">34: </span><span class="org-whitespace-space">   </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>1<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">35: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">switches.</span>
<span id="coderef-get-switches" class="coderef-off"><span class="linenr">36: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>switches<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-whitespace-space"> </span><span class="org-comment-delimiter">;;</span> (get-switches)</span>
<span class="linenr">37: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Get</span><span class="org-whitespace-space"> </span><span class="org-comment">parameters.</span>
<span class="linenr">38: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>parameters<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>match-string-no-properties<span class="org-whitespace-space"> </span>3<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>

</div>

<p>
（此代码块的 <code>switches</code> 是 <code>-n 24</code> ，使代码块从第 24 行开始计数，以便符合
<a href="#org-element-src-block-parser">org-element-src-block-parser</a> 中的情况。）
</p>

<p>
这部分的代码很清晰，就是通过正则匹配来得出代码块所用语言、<code>switches</code> 和代码块的其他参数。我们感兴趣的是 <code>coderef</code> ： <a href="#coderef-get-switches" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-get-switches');" onmouseout="CodeHighlightOff(this, 'coderef-get-switches');">get-switches</a> 。
</p>

<p>
当我们把光标移到 <a href="#coderef-get-switches" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-get-switches');" onmouseout="CodeHighlightOff(this, 'coderef-get-switches');">get-switches</a> 上面时，会发现代码块中对应的一行也被高亮了。这是通过 <code>(setq org-html-head-include-scripts t)</code> 实现的，它会把变量 <code>org-html-scripts</code>
中的 js 注入网页，实现高亮的效果<sup><label for="fnr.4" class="footref">4</label></sup><input id="fnr.4" class="footref-toggle" type="checkbox">。
</p>

<div class="multilang">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>switches-analysis</label><pre class="src src-emacs-lisp" id="switches-analysis"><span class="linenr">39: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Switches</span><span class="org-whitespace-space"> </span><span class="org-comment">analysis.</span>
<span id="coderef-num" class="coderef-off"><span class="linenr">40: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>number-lines</span>
<span class="linenr">41: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">42: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-whitespace-space"> </span><span class="org-string">*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\\&gt;"</span>
<span class="linenr">43: </span><span class="org-whitespace-space">                    </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">44: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>cons
<span class="linenr">45: </span><span class="org-whitespace-space">       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>equal<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>match-string<span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-whitespace-space"> </span><span class="org-string">"-"</span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span>
<span class="linenr">46: </span><span class="org-whitespace-space">           </span>'new
<span class="linenr">47: </span><span class="org-whitespace-space">         </span>'continued<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">48: </span><span class="org-whitespace-space">       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">if</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>match-end<span class="org-whitespace-space"> </span>2<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-whitespace-space"> </span>0
<span class="linenr">49: </span><span class="org-whitespace-space">         </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Subtract</span><span class="org-whitespace-space"> </span><span class="org-comment">1</span><span class="org-whitespace-space"> </span><span class="org-comment">to</span><span class="org-whitespace-space"> </span><span class="org-comment">give</span><span class="org-whitespace-space"> </span><span class="org-comment">number</span><span class="org-whitespace-space"> </span><span class="org-comment">of</span><span class="org-whitespace-space"> </span><span class="org-comment">lines</span><span class="org-whitespace-space"> </span><span class="org-comment">before</span>
<span class="linenr">50: </span><span class="org-whitespace-space">         </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">first</span><span class="org-whitespace-space"> </span><span class="org-comment">line.</span>
<span class="linenr">51: </span><span class="org-whitespace-space">         </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>1-<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">(</span></span>string-to-number<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">(</span></span>match-string<span class="org-whitespace-space"> </span>2<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-7">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-6">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span id="coderef-indent" class="coderef-off"><span class="linenr">52: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>preserve-indent</span>
<span class="linenr">53: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">54: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-i\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span id="coderef-label-fmt" class="coderef-off"><span class="linenr">55: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>label-fmt</span>
<span class="linenr">56: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>switches
<span class="linenr">57: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-l</span><span class="org-whitespace-space"> </span><span class="org-string">+\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">\"\n]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\""</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">58: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>match-string<span class="org-whitespace-space"> </span>1<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">59: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">Should</span><span class="org-whitespace-space"> </span><span class="org-comment">labels</span><span class="org-whitespace-space"> </span><span class="org-comment">be</span><span class="org-whitespace-space"> </span><span class="org-comment">retained</span><span class="org-whitespace-space"> </span><span class="org-comment">in</span><span class="org-whitespace-space"> </span><span class="org-comment">(or</span><span class="org-whitespace-space"> </span><span class="org-comment">stripped</span><span class="org-whitespace-space"> </span><span class="org-comment">from)</span>
<span class="linenr">60: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">source</span><span class="org-whitespace-space"> </span><span class="org-comment">blocks?</span>
<span id="coderef-retain-labels" class="coderef-off"><span class="linenr">61: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>retain-labels</span>
<span class="linenr">62: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">or</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>not<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">63: </span><span class="org-whitespace-space">     </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-r\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">64: </span><span class="org-whitespace-space">     </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>number-lines<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-k\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="linenr">65: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">What</span><span class="org-whitespace-space"> </span><span class="org-comment">should</span><span class="org-whitespace-space"> </span><span class="org-comment">code-references</span><span class="org-whitespace-space"> </span><span class="org-comment">use</span><span class="org-whitespace-space"> </span><span class="org-comment">-</span><span class="org-whitespace-space"> </span><span class="org-comment">labels</span><span class="org-whitespace-space"> </span><span class="org-comment">or</span>
<span class="linenr">66: </span><span class="org-comment-delimiter">;;</span><span class="org-whitespace-space"> </span><span class="org-comment">line-numbers?</span>
<span id="coderef-use-labels" class="coderef-off"><span class="linenr">67: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>use-labels</span>
<span class="linenr">68: </span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">or</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>not<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">69: </span><span class="org-whitespace-space">     </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span>retain-labels
<span class="linenr">70: </span><span class="org-whitespace-space">          </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>not<span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>string-match<span class="org-whitespace-space"> </span><span class="org-string">"-k\\&gt;"</span><span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>

</div>

<p>
（此代码块的 <code>switches</code> 是 <code>+n -r -l ";; (ref:%s)"</code>）
</p>

<p>
这一部分的工作是解析代码块中的 <code>switches</code> 。也基本上都是通过正则匹配来获得相应 的信息。第 <a href="#coderef-num" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-num');" onmouseout="CodeHighlightOff(this, 'coderef-num');">40</a> 、<a href="#coderef-indent" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-indent');" onmouseout="CodeHighlightOff(this, 'coderef-indent');">52</a> 和 <a href="#coderef-label-fmt" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-label-fmt');" onmouseout="CodeHighlightOff(this, 'coderef-label-fmt');">55</a> 行分别对应 <code>n</code> 、 <code>i</code> 和 <code>l</code> 三个<code>switches</code> 。第 <a href="#coderef-retain-labels" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-retain-labels');" onmouseout="CodeHighlightOff(this, 'coderef-retain-labels');">61</a> 和 <a href="#coderef-use-labels" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-use-labels');" onmouseout="CodeHighlightOff(this, 'coderef-use-labels');">67</a> 行则是考虑多个 <code>switches</code> 一起用的情况。第
<a href="#coderef-retain-labels" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-retain-labels');" onmouseout="CodeHighlightOff(this, 'coderef-retain-labels');">61</a> 行的 <code>retain-labels</code> 指是否保留代码块中的引用标签，如果有<code>-k</code> 则一定保留，其优先级最高，然后如果没有 <code>-k</code> 但是有 <code>-r</code> 就删除代码块中的引用标签。第
<a href="#coderef-use-labels" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-use-labels');" onmouseout="CodeHighlightOff(this, 'coderef-use-labels');">67</a> 行的 <code>use-labels</code> 则是判断是在链接中使用引用标签还是使用行号。
</p>

<p>
我们回到 <code>switches</code> , 这里行号用了 <code>+n</code> ，这是因为在 <a href="#org-element-src-block-parser">org-element-src-block-parser</a> 中
<a href="#regexp-match">regexp-match</a> 和 <a href="#switches-analysis">switches-analysis</a> 两部分是连在一起的，所以可以直接连起来。另外使用<code>-r</code> 来去除代码块中的引用标签，链接中改用行号来显示。注意这个工作是导出时
Org-mode 帮我们完成的，在 org 源文件中，代码引用的格式是一样的。
</p>

<div class="multilang">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>restult-construct</label><pre class="src src-emacs-lisp" id="restult-construct"><span class="linenr">81: </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>list<span class="org-whitespace-space"> </span>'src-block
<span class="linenr">82: </span><span class="org-whitespace-space">      </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span>nconc
<span class="linenr">83: </span><span class="org-whitespace-space">       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>list<span class="org-whitespace-space"> </span><span class="org-builtin">:language</span><span class="org-whitespace-space"> </span>language
<span class="linenr">84: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:switches</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>org-string-nw-p<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span>
<span class="linenr">85: </span><span class="org-whitespace-space">                            </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>org-trim<span class="org-whitespace-space"> </span>switches<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">86: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:parameters</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span><span class="org-keyword">and</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>org-string-nw-p<span class="org-whitespace-space"> </span>parameters<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span>
<span class="linenr">87: </span><span class="org-whitespace-space">                              </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">(</span></span>org-trim<span class="org-whitespace-space"> </span>parameters<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-5">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">88: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:begin</span><span class="org-whitespace-space"> </span>begin
<span class="linenr">89: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:end</span><span class="org-whitespace-space"> </span>end
<span class="linenr">90: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:number-lines</span><span class="org-whitespace-space"> </span>number-lines
<span class="linenr">91: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:preserve-indent</span><span class="org-whitespace-space"> </span>preserve-indent
<span class="linenr">92: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:retain-labels</span><span class="org-whitespace-space"> </span>retain-labels
<span class="linenr">93: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:use-labels</span><span class="org-whitespace-space"> </span>use-labels
<span class="linenr">94: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:label-fmt</span><span class="org-whitespace-space"> </span>label-fmt
<span class="linenr">95: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:value</span><span class="org-whitespace-space"> </span>value
<span class="linenr">96: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:post-blank</span><span class="org-whitespace-space"> </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">(</span></span>count-lines<span class="org-whitespace-space"> </span>pos-before-blank<span class="org-whitespace-space"> </span>end<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-4">)</span></span>
<span class="linenr">97: </span><span class="org-whitespace-space">             </span><span class="org-builtin">:post-affiliated</span><span class="org-whitespace-space"> </span>post-affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span>
<span class="linenr">98: </span><span class="org-whitespace-space">       </span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">(</span></span>cdr<span class="org-whitespace-space"> </span>affiliated<span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-mindre-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>

</div>

<p>
（此代码块的 <code>switches</code> 是 <code>-n 81</code>）
</p>

<p>
最后就是把结果组合成一个 List 返回。
</p>
</div>
</div>
<div id="outline-container-总结" class="outline-2">
<h2 id="总结">总结</h2>
<div class="outline-text-2" id="text-总结">
<p>
如果要写技术博客（笔记）的话，代码块是非常重要的一个环节，而 Org-mode 在这两方面都有极其优秀的支持。本文所介绍的内容仅仅是九牛一毛，只希望读者在阅读完毕后能够对 Org-mode 代码块中 <code>switches</code> 有更进一步的了解，感谢阅读！
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<code>switches</code> 也可用于 <code>#+BEGIN_EXAMPLE</code> 。
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
原文是 "Switches provide finer control of the code execution, export, and
format." 但是我没搞懂 <code>switches</code> 在代码执行的时候会有什么影响，只知道<code>org-babel--expand-body</code> 会在代码执行的时候移除 <code>coderef</code> 。这可能需要进一步分析
ob 的源码。
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
代码块中如果有 <code>&lt;&lt;xxx&gt;&gt;</code> 之类的文本，可以点击代码块上的 <code>expand</code> 按钮展开，也可以直接点击 <code>&lt;&lt;xxx&gt;&gt;</code> 跳转到定义位置。
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
需要 CSS 文件中设置 <code>.code-highlighted</code> 的样式。
</p></div></div>


</div>
</div></div>
<script src="https://giscus.app/client.js"
          data-repo="Elilif/Elilif.github.io"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyOTgxNjM5ODg="
          data-category="Announcements"
          data-category-id="DIC_kwDOEcWfFM4Cdz5V"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="top"
          data-theme="light"
          data-lang="zh-CN"
          crossorigin="anonymous"
          async>
  </script><div id="postamble" class="status">
<hr class="Solid">
<div class="info">
  <span class="author">Author: Eli Qian</span>
  <span class="author">Email: <a href="mailto:eli.q.qian@gmail.com">eli.q.qian@gmail.com</a></span>
  <span class="date">Create Date: 2024-03-01</span>
  <span class="date">Last modified: 2024-03-09</span>
  <span>Creator: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.2 (<a href="https://orgmode.org">Org</a> mode 9.6.15)</span>
</div>
</div>
</body>
</html>
